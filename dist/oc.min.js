/*!
 * OOPCanvas JavaScript Library
 * http://marty_wang.no.de/
 * Licensed under the MIT license.
 *
 * Copyright (C) 2011 by Mo Wang
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
var OOPCanvas=(function(){debug.setLevel(0);a.meta={version:"0.0.0",author:"Mo Wang",repo:"git@github.com:marty-wang/OOPCanvas.git",license:"MIT"};function a(){}a._inits=[];a.installPlugin=function(d,c){var b=a.prototype;b[d]=function(){if(!!c){return c.apply(this,arguments)}}};a.initialize=function(b){a._inits.push(b)};a.prototype._initModules=function(){debug.info("+++ Start to Init Modules +++");var b=this;var c,f;var e=a._inits;var d=e.length;for(c=0;c<d;c++){f=e[c];f(b)}debug.info("+++ Completed Modules Init +++")};return a})();"OC" in window||(window.OC=OOPCanvas);(function(a){a.Util={};var c=a.Util;c.hasOwnProperty=function(d,e){return Object.prototype.hasOwnProperty.call(d,e)};a.Util.iterateProperties=function(e,g){var f;var d=this;for(f in e){if(d.hasOwnProperty(e,f)){g(f,e[f])}}};a.Util.merge=function b(h,d){var g=arguments[2];var f=arguments[3];var e=false;var k=[];if(typeof g==="boolean"){e=g;if(typeof f==="object"){k=f}}else{if(typeof g==="object"){k=g}}var j={};if(!e){j=b(j,h,true)}else{j=h}var i;for(i in d){if(k.indexOf(i)>-1){continue}if(a.Util.hasOwnProperty(d,i)){j[i]=d[i]}}return j};a.Util.sync=function(f,e){var d;for(d in f){if(OOPCanvas.Util.hasOwnProperty(f,d)){if(d in e){f[d]=e[d]}else{e[d]=f[d]}}}};a.Util.rand=function(d){d=d||10;return Math.uuid(d)};a.Util.inherit=function(d,f){var e=function(){};e.prototype=f.prototype;d.prototype=new e();d.prototype.constructor=d;d.__super=function(j,g){var i=f.prototype[g];if(!!i){var h=Array.prototype.slice.call(arguments,2);return i.apply(j,h)}}};a.Util.domElementPosition=function(e){var f=0;var d=0;if(e.offsetParent){while(1){f+=e.offsetLeft;d+=e.offsetTop;if(!e.offsetParent){break}e=e.offsetParent}}else{if(e.x){f+=e.x}if(e.y){d+=e.y}}return{left:f,top:d}};a.Util.arrayIndexOf=function(j,g){var d=-1;if(j.indexOf){d=j.indexOf(g)}else{var e,f;for(e=0,f=j.length;e<f;e++){var h=j[e];if(h===g){d=e;break}}}return d};a.Util.arrayRemove=function(g,f,e){var d=g.slice((e||f)+1||g.length);g.length=f<0?g.length+f:f;return g.push.apply(g,d)};a.Util.arrayRemoveObject=function(f,e){var d=this.indexOf(f,e);if(d<0){return}a.Util.arrayRemove(f,d)}})(OOPCanvas);debug.info("util module is installed.");(function(f,d){f.initialize(function(l){l._runloop=new e(l);debug.info("runloop module is init'ed.")});var a=60;f.prototype.startRunloop=function(){this._runloop._startLoop()};f.prototype.stopRunloop=function(){this._runloop._stopLoop()};f.prototype.isLooping=function(){return this._runloop._isLooping};f.prototype.getCurrentFPS=function(){return this._runloop._curFPS};f.prototype.installHook=function(l){this._runloop._hooks.push(l)};f.prototype.removeHook=function(l){};f.prototype.installPostHook=function(l){this._runloop._postHooks.unshift(l)};f.prototype.removePostHook=function(l){};function e(l){this._config={fps:a,useOptimizedRunloop:false};this._oc=l;this._shouldRun=false;this._isLooping=false;this._lastFrame=null;this._curFPS=null;this._hooks=[];this._postHooks=[];this._requestFrameFunc=null;var m=this._oc.getGlobalConfig();f.Util.sync(this._config,m);if(this._config.fps>0){if(this._config.useOptimizedRunloop){this._config.fps=d;m.fps=d}this._requestFrameFunc=j(this._config.fps)}}e.prototype._startLoop=function(){if(this._isLooping){return}if(!!this._requestFrameFunc){this._shouldRun=true}b(this)};e.prototype._stopLoop=function(){if(this._isLooping){this._shouldRun=false}};function b(m){(function l(){c(m);if(m._shouldRun){m._requestFrameFunc(l);m._isLooping=true}else{m._isLooping=false}})()}function c(l){i(l);g(l);h(l)}function g(l){k(l,l._hooks)}function h(l){k(l,l._postHooks)}function k(p,l){var m,o;var n=l.length;for(m=0;m<n;m++){o=l[m];o(p._oc)}}function j(p){var m=null;var l=window.setTimeout;var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||l;var o;if(p>0){o=l}else{if(p===d){o=n;p=a}}if(o===l){m=function(q){o(q,1000/p)}}else{if(o!==d){m=function(q){o(q)}}}return m}function i(n){var l,m;var o=new Date().getTime();l=o-n._lastFrame;if(~~l){n._curFPS=Math.ceil(1000/l)}n._lastFrame=o}debug.info("runloop module is installed.")})(OOPCanvas);(function(a){a.initialize(function(e){e.installPostHook(function(f){d(f)});debug.info("core module is init'ed.")});a.create=function(f,g){var e=new a();e._core=new c(f,g);e._initModules();return e};a.prototype.changeCursor=function(e){this._core._canvas.style.cursor=e};a.prototype.getPosition=function(){return this._core._position};a.prototype.getSize=function(){return{width:this._core._width,height:this._core._height}};a.prototype.getCanvas=function(){return this._core._canvas};a.prototype.getContext=function(){var e=this._core;return e.useBackBuffer()?e._backBufferCtx:e._ctx};a.prototype.clear=function(f,i,h,e){var g=this._core;g._ctx.clearRect(f,i,h,e);if(!!g._backBufferCtx){g._backBufferCtx.clearRect(f,i,h,e)}};a.prototype.clearAll=function(){var e=this.getSize();this.clear(0,0,e.width,e.height)};a.prototype.getGlobalConfig=function(){return this._core._globalConfig};function d(f){var e=f._core;if(e.useBackBuffer()){e._ctx.drawImage(e._backBuffer,0,0)}}function c(e,f){if(!e){throw"Canvas cannot be null or undefined"}this._ctx=e.getContext("2d");if(!this._ctx){throw"The passed-in canvas argument is not valid"}this._canvas=e;this._backBuffer=null;this._backBufferCtx=null;this._position=a.Util.domElementPosition(e);this._width=e.getAttribute("width");this._height=e.getAttribute("height");this._config={useBackBuffer:false};this._globalConfig=f||{};a.Util.sync(this._config,this._globalConfig);if(this._config.useBackBuffer){b(this)}}c.prototype.useBackBuffer=function(){return this._config.useBackBuffer};function b(e){var f=document.createElement("canvas");f.width=e._width;f.height=e._height;e._backBufferCtx=f.getContext("2d");e._backBuffer=f}debug.info("core module is installed.")})(OOPCanvas);(function(c){c.Animator=b;c.prototype.animator=function(f){return new b(f)};var a=250;function b(f){this._object=f;this._bv=null;this._ev=null;this._cv=null;this._props=null;this._duration=null;this._easing=null;this._callbacks=null;this._startTime=null;this._deltaCurTime=null;this._endTime=null;this._isAnimating=false;this._curVals=null}b.easingFunctions={};b.easingFunctions.linear=function(g,f,i,h){return i*g/h+f};b.addEasingFunction=function(g,h){var f=b.easingFunctions;if(g in f){throw'"'+g+'" easing function already exists!'}f[g]=h};b.prototype.start=function(o,g){g=g||{};var i=g.duration;var h=g.easingFunction;var n=g.callbacks;this._startTime=new Date().getTime();this._endTime=this._startTime+this._duration;this._duration=~~i<=0?a:i;this._easingFunc=d(h);this._callbacks=n||{};var l=this._object;var j;var r,k,p;var m=false;var q={};c.Util.iterateProperties(o,function(t,s){j=e(l,t);if(!!j){r=l[j];p=s;k=p-r;if(k!==0){q[t]=[r,k];if(!m){m=true}}}});if(!m){return}this._props=q;this._isAnimating=true;var f=this._callbacks.start;if(!!f){f(o)}};b.prototype.stop=function(){if(!this._isAnimating){return}this._isAnimating=false;var f=this._callbacks.complete;if(!!f){f(this._curVals)}};b.prototype.update=function(f){if(!this._isAnimating){return false}var h=this;var m=h._object;var i=f-h._startTime;var n=h._props;var j=h._duration;var l;var k;var o={};var g=h._easingFunc;var p=h._callbacks.animating;c.Util.iterateProperties(n,function(r,q){if(i>=j){k=q[0]+q[1]}else{k=g(i,q[0],q[1],j)}l=e(m,r);m[l]=k;o[r]=k});h._curVals=o;if(i>=j){h.stop()}if(h._isAnimating&&!!p){p(o)}return true};function e(f,h){var g;if(h in f){g=h}else{if("_"+h in f){g="_"+h}}return g}function d(f){if(!f){f="linear"}var g;if(typeof f==="string"){g=b.easingFunctions[f]}else{g=f}if(!g){g=b.easingFunctions.linear}return g}debug.info("animation module is installed.")})(OOPCanvas);(function(b,e){var a=b.Animator.easingFunctions;a.easeInQuad=function(g,f,i,h){g=g/h;return i*g*g+f};a.easeOutQuad=function(g,f,i,h){g=g/h;return -i*g*(g-2)+f};a.easeInOutQuad=function(g,f,i,h){g=g/(h/2);if(g<1){return i/2*g*g+f}return -i/2*((--g)*(g-2)-1)+f};a.easeInCubic=function(g,f,i,h){return i*(g/=h)*g*g+f};a.easeOutCubic=function(g,f,i,h){g=g/h-1;return i*(g*g*g+1)+f};a.easeInOutCubic=function(g,f,i,h){g=g/(h/2);if(g<1){return i/2*g*g*g+f}g=g-2;return i/2*(g*g*g+2)+f};a.easeInQuart=function(g,f,i,h){g=g/h;return i*g*g*g*g+f};a.easeOutQuart=function(g,f,i,h){g=g/h-1;return -i*(g*g*g*g-1)+f};a.easeInOutQuart=function(g,f,i,h){g=g/(h/2);if(g<1){return i/2*g*g*g*g+f}g=g-2;return -i/2*(g*g*g*g-2)+f};a.easeInQuint=function(g,f,i,h){return i*(g/=h)*g*g*g*g+f};a.easeOutQuint=function(g,f,i,h){return i*((g=g/h-1)*g*g*g*g+1)+f};a.easeInOutQuint=function(g,f,i,h){g=g/(h/2);if(g<1){return i/2*g*g*g*g*g+f}g=g-2;return i/2*(g*g*g*g*g+2)+f};a.easeInSine=function(g,f,i,h){return -i*Math.cos(g/h*(Math.PI/2))+i+f};a.easeOutSine=function(g,f,i,h){return i*Math.sin(g/h*(Math.PI/2))+f};a.easeInOutSine=function(g,f,i,h){return -i/2*(Math.cos(Math.PI*g/h)-1)+f};a.easeInExpo=function(g,f,i,h){return(g===0)?f:i*Math.pow(2,10*(g/h-1))+f};a.easeOutExpo=function(g,f,i,h){return(g===h)?f+i:i*(-Math.pow(2,-10*g/h)+1)+f};a.easeInOutExpo=function(g,f,i,h){if(g===0){return f}if(g===h){return f+i}g=g/(h/2);if(g<1){return i/2*Math.pow(2,10*(g-1))+f}return i/2*(-Math.pow(2,-10*--g)+2)+f};a.easeInCirc=function(g,f,i,h){g=g/h;return -i*(Math.sqrt(1-g*g)-1)+f};a.easeOutCirc=function(g,f,i,h){g=g/h-1;return i*Math.sqrt(1-g*g)+f};a.easeInOutCirc=function(g,f,i,h){g=g/(h/2);if(g<1){return -i/2*(Math.sqrt(1-g*g)-1)+f}g=g-2;return i/2*(Math.sqrt(1-g*g)+1)+f};a.easeInElastic=function(h,f,l,k,g,j){if(h===0){return f}h=h/k;if(h===1){return f+l}if(j===e){j=k*0.3}var i;if(~~g<Math.abs(l)){g=l;i=j/4}else{i=j/(2*Math.PI)*Math.asin(l/g)}h=h-1;return -(g*Math.pow(2,10*h)*Math.sin((h*k-i)*(2*Math.PI)/j))+f};a.easeOutElastic=function(h,f,l,k,g,j){if(h===0){return f}h=h/k;if(h===1){return f+l}if(j===e){j=k*0.3}var i;if(~~g<Math.abs(l)){g=l;i=j/4}else{i=j/(2*Math.PI)*Math.asin(l/g)}return g*Math.pow(2,-10*h)*Math.sin((h*k-i)*(2*Math.PI)/j)+l+f};a.easeInOutElastic=function(h,f,l,k,g,j){if(h===0){return f}h=h/(k/2);if(h===2){return f+l}if(j===e){j=k*(0.3*1.5)}var i;if(~~g<Math.abs(l)){g=l;i=j/4}else{i=j/(2*Math.PI)*Math.asin(l/g)}if(h<1){h=h-1;return -0.5*(g*Math.pow(2,10*h)*Math.sin((h*k-i)*(2*Math.PI)/j))+f}h=h-1;return g*Math.pow(2,-10*h)*Math.sin((h*k-i)*(2*Math.PI)/j)*0.5+l+f};a.easeInBack=function(g,f,j,i,h){if(h===e){h=1.70158}g=g/i;return j*g*g*((h+1)*g-h)+f};a.easeOutBack=function(g,f,j,i,h){if(h===e){h=1.70158}g=g/i-1;return j*(g*g*((h+1)*g+h)+1)+f};a.easeInOutBack=function(g,f,j,i,h){if(h===e){h=1.70158}g=g/(i/2);h=h*1.525;if(g<1){return j/2*(g*g*((h+1)*g-h))+f}g=g-2;return j/2*(g*g*((h+1)*g+h)+2)+f};a.easeInBounce=d;a.easeOutBounce=c;a.easeInOutBounce=function(g,f,i,h){if(g<h/2){return d(g*2,0,i,h)*0.5+f}return c(g*2-h,0,i,h)*0.5+i*0.5+f};function d(g,f,i,h){return i-c(h-g,0,i,h)+f}function c(g,f,i,h){g=g/h;if(g<(1/2.75)){return i*(7.5625*g*g)+f}else{if(g<(2/2.75)){g=g-(1.5/2.75);return i*(7.5625*g*g+0.75)+f}else{if(g<(2.5/2.75)){g=g-(2.25/2.75);return i*(7.5625*g*g+0.9375)+f}else{g=g-(2.625/2.75);return i*(7.5625*g*g+0.984375)+f}}}}debug.info("easing module is installed.")})(OOPCanvas);(function(a){a.Collections={};a.Collections.Dict=function b(c){this._dict={};this._orders=[];this._sort=c;if(!!this._sort){var f=this;var e=f._sort;this._sortWrapper=function(i,g){var h=f._dict[i];var d=f._dict[g];return e(h,d)}}};var b=a.Collections.Dict;b.prototype.getValue=function(c){return this._dict[c]};b.prototype.isSorted=function(){return !!this._sort};b.prototype.contain=function(c){return(c in this._dict)};b.prototype.add=function(c,d){if(c in this._dict){return}this._dict[c]=d;if(!!this._sort){this._orders.push(c);this._orders.sort(this._sortWrapper)}};b.prototype.addItems=function(c){var e,h,d,g;var f=c.length;for(e=0;e<f;e++){h=c[e];d=h[0];g=h[1];if(d in this._dict){continue}this._dict[d]=g;if(!!this._sort){this._orders.push(d)}}if(!!this._sort){this._orders.sort(this._sortWrapper)}};b.prototype.remove=function(c){if(c in this._dict){delete this._dict[c];if(!!this._sort){a.Util.arrayRemoveObject(this._orders,c);this._orders.sort(this._sortWrapper)}}};b.prototype.removeItems=function(f){if(typeof f==="undefined"){this.removeAll()}else{var d,c;var e=f.length;for(d=0;d<e;d++){c=f[d];if(c in this._dict){delete this._dict[c];if(!!this._sort){a.Util.arrayRemoveObject(this._orders,c)}}}this._orders.sort(this._sortWrapper)}};b.prototype.removeAll=function(){this._dict={};this._orders.length=0};b.prototype.iterate=function(g){var e,f;if(!!this._sort){var d;var c=this._orders.length;for(d=0;d<c;d++){e=this._orders[d];f=this._dict[e];g(e,f)}}else{for(e in this._dict){if(OOPCanvas.Util.hasOwnProperty(this._dict,e)){f=this._dict[e];g(e,f)}}}}})(OOPCanvas);(function(OC){var _EXCLUDES=["rotate","translate","scale","transform"];var _config={textBaseline:"top",font:"14px sans-serif"};OC.initialize(function(oc){var gConfig=oc.getGlobalConfig();OC.Util.sync(_config,gConfig);debug.info("drawing module is init'ed.")});OC.prototype.updateConfig=function(config,updates){OC.Util.merge(config,updates,true,_EXCLUDES)};OC.prototype.createLinearGradient=function(x0,y0,x1,y1,stops){var ctx=this.getContext();var lingrad=ctx.createLinearGradient(x0,y0,x1,y1);var i,stop;var count=stops.length;for(i=0;i<count;i++){stop=stops[i];lingrad.addColorStop(stop[0],stop[1])}return lingrad};OC.prototype.drawLine=function(x0,y0,x1,y1,config){_setup(this,function(ctx){ctx.beginPath();ctx.moveTo(x0,y0);ctx.lineTo(x1,y1);ctx.stroke()},config)};OC.prototype.drawLines=function(points,config){var p0=points[0];var i,p;var count=points.length;_setup(this,function(ctx){ctx.beginPath();ctx.moveTo(p0[0],p0[1]);for(i=1;i<count;i++){p=points[i];ctx.lineTo(p[0],p[1])}ctx.stroke()},config)};OC.prototype.drawPolygon=function(centerX,centerY,radius,sides,config){config=config||{};var deg=Math.PI*2/sides;_setup(this,function(ctx){ctx.beginPath();ctx.moveTo(centerX,centerY-radius);var i,d,x,y;for(i=1;i<sides;i++){d=i*deg-Math.PI/2;x=centerX+Math.cos(d)*radius;y=centerY+Math.sin(d)*radius;ctx.lineTo(x,y)}ctx.closePath();ctx.fill();ctx.stroke()},config)};OC.prototype.drawRectangle=function(x,y,width,height,config){config=config||{};_setup(this,function(ctx){if(config.anchor==="center"){x-=width/2;y-=height/2}var rotation=config.rotation;if(rotation){x=x+width/2;y=y+height/2;ctx.translate(x,y);ctx.rotate(rotation);x=-width/2;y=-height/2}else{ctx.translate(x,y);x=0;y=0}var cr=config.cornerRadius;ctx.beginPath();if(cr){ctx.moveTo(x+cr,y);ctx.lineTo(x+width-cr,y);ctx.arcTo(x+width,y,x+width,y+cr,cr);ctx.lineTo(x+width,y+height-cr);ctx.arcTo(x+width,y+height,x+width-cr,y+height,cr);ctx.lineTo(x+cr,y+height);ctx.arcTo(x,y+height,x,y+height-cr,cr);ctx.lineTo(x,y+cr);ctx.arcTo(x,y,x+cr,y,cr)}else{ctx.rect(x,y,width,height)}ctx.closePath();ctx.fill();ctx.stroke()},config)};OC.prototype.drawEllipse=function(x,y,width,height,config){_setup(this,function(ctx){var w=width;var h=height;var kappa=0.5522848;var ox=(w/2)*kappa;var oy=(h/2)*kappa;var xe=x+w;var ye=y+h;var xm=x+w/2;var ym=y+h/2;ctx.beginPath();ctx.moveTo(x,ym);ctx.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);ctx.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);ctx.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);ctx.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);ctx.closePath();ctx.fill();ctx.stroke()},config)};OC.prototype.drawArc=function(centerX,centerY,radius,startingAngle,endingAngle,counterClockwise,config){_setup(this,function(ctx){var x=centerX+radius*Math.cos(startingAngle);var y=centerY+radius*Math.sin(startingAngle);ctx.beginPath();ctx.moveTo(x,y);ctx.arc(centerX,centerY,radius,startingAngle,endingAngle,counterClockwise);ctx.fill();ctx.stroke()},config)};OC.prototype.drawCircle=function(centerX,centerY,radius,config){this.drawArc(centerX,centerY,radius,0,Math.PI*2,false,config)};OC.prototype.drawPath=function _drawPath(x,y,pathData,config){if(!_drawPath._parser){_drawPath._parser=new PathHandler()}_setup(this,function(ctx){var routine=_drawPath._parser.parse(pathData);with(ctx){translate(x,y);beginPath();eval(routine);fill();stroke()}},config)};OC.prototype.drawImage=function(x,y){var ctx=this.getContext();ctx.save();ctx.translate(x,y);ctx.drawImage.apply(ctx,arguments);ctx.restore()};OC.prototype.drawText=function(x,y,text,config){_setup(this,function(ctx){ctx.fillText(text,x,y)},config)};function _setup(oc,draw,config){var ctx=oc.getContext();ctx.save();config=config||{};_stylize(oc,config);draw(ctx);ctx.restore()}function _stylize(oc,config){var mergedConfig=OC.Util.merge(oc.getGlobalConfig(),config);var ctx=oc.getContext();oc.updateConfig(ctx,mergedConfig)}function PathHandler(context){this._ctx=context;this._parser=new PathParser();this._parser.setHandler(this);this._pathData=null;this._routine=null;this._lastPoint=null;this._lastControlPoint=null;this._routines={}}PathHandler.prototype.parse=function(data){if(!(data in this._routines)){this._pathData=data;this._routine=[];this._parser.parseData(data);this._routines[data]=this._routine.join("")}return this._routines[data]};PathHandler.prototype.addRoutine=function(name,params){var result=[];var args=[];for(var i=0;i<params.length;i++){args[i]=params[i]}result.push(name);result.push("(");result.push(args.join(","));result.push(")");this._routine.push(result.join("")+";")};PathHandler.prototype.movetoAbs=function(x,y){this.addRoutine("moveTo",arguments);this._lastPoint=[x,y]};PathHandler.prototype.movetoRel=function(x,y){this.movetoAbs.apply(this,arguments)};PathHandler.prototype.linetoAbs=function(x,y){this.addRoutine("lineTo",arguments);this._lastPoint=[x,y]};PathHandler.prototype.linetoRel=function(x,y){this.linetoAbs.apply(this,arguments)};PathHandler.prototype.linetoHorizontalAbs=function(x){var args=[x,this._lastPoint[1]];this.linetoAbs.apply(this,args)};PathHandler.prototype.linetoHorizontalRel=function(x){this.linetoHorizontalAbs.apply(this,arguments)};PathHandler.prototype.linetoVerticalAbs=function(y){var args=[this._lastPoint[0],y];this.linetoAbs.apply(this,args)};PathHandler.prototype.linetoVerticalRel=function(y){this.linetoVerticalAbs.apply(this,arguments)};PathHandler.prototype.curvetoCubicAbs=function(x1,y1,x2,y2,x,y){this.addRoutine("bezierCurveTo",arguments);this._lastPoint=[x,y];this._lastControlPoint=[x2,y2]};PathHandler.prototype.curvetoCubicRel=function(x1,y1,x2,y2,x,y){this.curvetoCubicAbs.apply(this,arguments)};PathHandler.prototype.curvetoCubicSmoothAbs=function(x2,y2,x,y){var args=Array.prototype.concat.apply(_getReflectionPoint(this._lastControlPoint,this._lastPoint),arguments);this.curvetoCubicAbs.apply(this,args)};PathHandler.prototype.curvetoCubicSmoothRel=function(x2,y2,x,y){this.curvetoCubicSmoothAbs.apply(this,arguments)};PathHandler.prototype.curvetoQuadraticAbs=function(x1,y1,x,y){this.addRoutine("quadraticCurveTo",arguments);this._lastPoint=[x,y];this._lastControlPoint=[x1,y1]};PathHandler.prototype.curvetoQuadraticRel=function(x1,y1,x,y){this.curvetoQuadraticAbs.apply(this,arguments)};PathHandler.prototype.curvetoQuadraticSmoothAbs=function(x,y){var args=Array.prototype.concat.apply(_getReflectionPoint(this._lastControlPoint,this._lastPoint),arguments);this.curvetoQuadraticAbs.apply(this,args)};PathHandler.prototype.curvetoQuadraticSmoothRel=function(x,y){this.curvetoQuadraticSmoothAbs.apply(this,arguments)};PathHandler.prototype.arcAbs=function(rx,ry,xAxisRotation,largeArcFlag,sweepFlag,x,y){throw"not supported yet"};PathHandler.prototype.arcRel=function(rx,ry,xAxisRotation,largeArcFlag,sweepFlag,x,y){this.arcAbs.apply(this,arguments)};PathHandler.prototype.closePath=function(){this.addRoutine("closePath",arguments)};function _getReflectionPoint(point,origin){var refX=origin[0]-point[0]+origin[0];var refY=origin[1]-point[1]+origin[1];return[refX,refY]}debug.info("drawing module is installed.")})(OOPCanvas);(function(b){var c={showDebugInfo:false};b.initialize(function(e){var f=e.getGlobalConfig();b.Util.sync(c,f);if(c.showDebugInfo){e.installPostHook(d)}debug.info("debug module is init'ed.")});function d(e){a(e)}function a(e){var h=e.getCurrentFPS();var g=""+h;var f="green";if(h<30){f="red"}e.drawText(0,0,g,{fillStyle:f})}debug.info("debug module is installed.")})(OOPCanvas);(function(a){a.EventEmitter=b;a.prototype.eventEmitter=function(){return new b()};function b(){this._eventsMapper={}}b.prototype.subscribe=function(c,d){if(typeof d!=="object"&&typeof d!=="function"){throw"The subcriber needs to be either an object or a function"}var e=this._eventsMapper;if(!Object.prototype.hasOwnProperty.call(e,c)){e[c]=[]}e[c].push(d)};b.prototype.unsubscribe=function(c,e){var f=this._eventsMapper[c];if(f===undefined){return}if(e===undefined){f.length=0}else{var d=a.Util.arrayIndexOf(f,e);if(d>-1){f.splice(d,1)}}if(f.length===0){delete this._eventsMapper[c]}};b.prototype.fire=function(g,d,c){var j=this._eventsMapper[d];if(j===undefined){return}var e=j.length;var f;var h;var k;for(f=0;f<e;f++){h=j[f];if(typeof h==="function"){h.call(null,g,c)}else{if(typeof h==="object"){k="on"+d;h[k].call(h,g,c)}}}};debug.info("eventEmitter module is installed.")})(OOPCanvas);(function(e){e.initialize(function(m){m._interaction=new a(m);debug.info("interaction module is init'ed.")});var g=e.prototype;g._dequeueEvent=function(){return this._interaction.dequeueEvent()};g._hitTest=function(n,m,o){return this._interaction.hitTest(n,m,o)};g._getHitTestContext=function(){return this._interaction.getHitTestContext()};function a(m){this._oc=m;this._canvas=m.getCanvas();this._refPoint=m.getPosition();this._hitTestCtx=null;this._events=[];h(this);f(this)}a.prototype.getHitTestContext=function(){return this._hitTestCtx};a.prototype.hitTest=function(p,n,q){var o=this._hitTestCtx;var m=null;if(o.isPointInPath(n,q)){m={element:p,point:[n,q]}}return m};a.prototype.dequeueEvent=function(){return b(this)};function h(o){var n=o._oc;var m=document.createElement("canvas");var p=n.getSize();m.width=p.width;m.height=p.height;o._hitTestCtx=m.getContext("2d")}var l=["click","mousemove","mousedown","mouseup"];function f(m){var n=m._canvas;for(var o=0,p=l.length;o<p;o++){c(n,l[o],function(q){i(m,q)})}}function j(n,m){debug.debug("interaction: on mouse move");i(n,m)}function k(n,m){debug.debug("interaction: on click");i(n,m)}function c(n,m,o){n.addEventListener(m,o,false)}function i(n,o){o=!o?window.event:o;var p=d(o,n._refPoint);var m={type:o.type,left:p[0],top:p[1]};n._events.push(m)}function b(m){return m._events.shift()}function d(o,n){var m=0;var p=0;if(o.pageX||o.pageY){m=o.pageX;p=o.pageY}else{if(o.clientX||o.clientY){m=o.clientX+document.body.scrollLeft;p=o.clientY+document.body.scrollTop}}return[m-n.left,p-n.top]}debug.info("interaction module is installed.")})(OOPCanvas);(function(a){a.UIElement=b;a.UIControls={};function b(c){this._oc=c;this._id=a.Util.rand();this._zIndex=0;this._left=null;this._top=null;this._centerX=null;this._centerY=null;this._config=null;this._isDirty=true;this._isHitTestVisible=true;this._eventEmitter=this._oc.eventEmitter();this._animator=null}b.Max_ZIndex=Number.MAX_VALUE;b.Min_ZIndex=-b.Max_ZIndex;b.prototype.getId=function(){return this._id};b.prototype.getZIndex=function(){return this._zIndex};b.prototype.setZIndex=function(c){this._zIndex=c;this.invalidate()};b.prototype.invalidate=function(){this._isDirty=true};b.prototype.isDirty=function(){return this._isDirty};b.prototype.setHitTestVisible=function(c){this._isHitTestVisible=c};b.prototype.config=function(e,d){if(!this._config){this._config={}}if(typeof e==="object"){var c=this._oc;c.updateConfig(this._config,e)}else{this._config[e]=d}this.invalidate()};b.prototype.setPosition=function(d,c){this._left=d;this._top=c;this.invalidate()};b.prototype.bind=function(c,d){this._eventEmitter.subscribe(c,d)};b.prototype.unbind=function(c,d){this._eventEmitter.unsubscribe(c,d)};b.prototype.fire=function(d,c){this._eventEmitter.fire(this,d,c)};b.prototype.click=function(c){this.bind("click",c)};b.prototype.animate=function(d,e,c){if(!this._animator){this._animator=this._oc.animator(this)}this._animator.start(d,e,c)};b.prototype.update=function(c){return this._update(c)};b.prototype.draw=function(){this._draw();this._isDirty=false};b.prototype.hitTest=function(g,f){if(!this._isHitTestVisible){return null}var c=this._oc;var l=c.getSize();var i=l.width;var e=l.height;var j=c._getHitTestContext();j.clearRect(0,0,i,e);var d=c.getContext;c.getContext=function(){return j};var k=this._hitTest(g,f);c.getContext=d;return k};b.prototype.testPointInPath=function(c,d){return this._oc._hitTest(this,c,d)};b.prototype._update=function(c){if(!!this._animator){this._isDirty|=this._animator.update(c)}return !!this._isDirty};b.prototype._draw=function(){};b.prototype._hitTest=function(c,d){};b.prototype._click=function(){this.fire("click")};b.prototype._mouseover=function(){this.fire("mouseover")};b.prototype._mousemove=function(){this.fire("mousemove")};b.prototype._mouseout=function(){this.fire("mouseout")};b.prototype._mousedown=function(){this.fire("mousedown")};b.prototype._mouseup=function(){this.fire("mouseup")};debug.info("ui module UIElement submodule is installed.")})(OOPCanvas);(function(c){c.UIPrimitives={};c.UIPrimitives.Rectangle=d;c.UIPrimitives.Polygon=b;c.UIPrimitives.Path=e;c.UIPrimitives.Background=a;c.prototype.rectangle=function(i,h,g,f){return new d(this,i,h,g,f)};c.prototype.polygon=function(i,h,f,g){return new b(this,i,h,f,g)};c.prototype.path=function(g,f,h){return new e(this,g,f,h)};c.prototype.background=function(f){return new a(this,f)};function d(g,j,i,h,f){d.__super(this,"constructor",g);this._left=j;this._top=i;this._width=h;this._height=f;this._id="Rect-"+this._id}c.Util.inherit(d,c.UIElement);d.prototype._draw=function(){var f=this._oc;f.drawRectangle(this._left,this._top,this._width,this._height,this._config)};d.prototype._hitTest=function(f,h){var g=this._oc;g.drawRectangle(this._left,this._top,this._width,this._height);return this.testPointInPath(f,h)};function b(g,j,i,f,h){b.__super(this,"constructor",g);this._centerX=j;this._centerY=i;this._radius=f;this._sides=h}c.Util.inherit(b,c.UIElement);b.prototype.setSides=function(f){this._sides=f;this.invalidate()};b.prototype.getSides=function(){return this._sides};b.prototype._draw=function(){var f=this._oc;f.drawPolygon(this._centerX,this._centerY,this._radius,this._sides,this._config)};b.prototype._hitTest=function(f,h){var g=this._oc;g.drawPolygon(this._centerX,this._centerY,this._radius,this._sides);return this.testPointInPath(f,h)};function e(f,h,g,i){e.__super(this,"constructor",f);this._left=h;this._top=g;this._pathData=i}c.Util.inherit(e,c.UIElement);e.prototype._draw=function(){var f=this._oc;f.drawPath(this._left,this._top,this._pathData,this._config)};e.prototype._hitTest=function(f,g){this._oc.drawPath(this._left,this._top,this._pathData);return this.testPointInPath(f,g)};function a(f,g){a.__super(this,"constructor",f);this._left=0;this._top=0;var h=f.getSize();this._width=h.width;this._height=h.height;this._zIndex=c.UIElement.Min_ZIndex;this._config=g}c.Util.inherit(a,c.UIElement);a.prototype._draw=function(){var f=this._oc;f.drawRectangle(this._left,this._top,this._width,this._height,this._config)}})(OOPCanvas);(function(c){c.UIControls.Button=b;c.prototype.button=function(g,f){return new b(this,g,f)};function b(f,h,g){b.__super(this,"constructor",f,h,g,0,0);this._id="Button-"+this._id;this._gradientNormal=null;this._gradientHover=null;this._gradientPress=null;this.setSize(300,50);this._state=b.States.Normal}c.Util.inherit(b,c.UIPrimitives.Rectangle);b.States={Normal:"Normal",Hover:"Hover",Press:"Press"};b.prototype.setSize=function(g,f){this._width=g;this._height=f;d(this);this.invalidate()};b.prototype._draw=function(){var f=this._oc;f.drawRectangle(this._left,this._top,this._width,this._height,{fillStyle:a(this),strokeStyle:"transparent",cornerRadius:6});f.drawLine(this._left,this._top,this._left+20,this._top+20)};b.prototype._click=function(){b.__super(this,"_click")};b.prototype._mouseover=function(){this._oc.changeCursor("pointer");e(this,b.States.Hover);b.__super(this,"_mouseover")};b.prototype._mousemove=function(){b.__super(this,"_mousemove")};b.prototype._mouseout=function(){this._oc.changeCursor("default");e(this,b.States.Normal);b.__super(this,"_mouseout")};function e(f,g){if(f._state===g){return}f._state=g;f.invalidate()}function d(g){var f=g._oc;var h=[[0,"#b8e1fc"],[0.1,"#a9d2f3"],[0.25,"#90bae4"],[0.37,"#90bcea"],[0.5,"#90bff0"],[0.51,"#6ba8e5"],[0.83,"#a2daf5"],[1,"#bdf3fd"]];g._gradientNormal=f.createLinearGradient(0,0,0,g._height,h);h=[[0,"#3b679e"],[0.5,"#2b88d9"],[0.51,"#207cca"],[1,"#7db9e8"]];g._gradientHover=f.createLinearGradient(0,0,0,g._height,h);h=[[0,"#1E5799"],[0.5,"#2989D8"],[0.51,"#207cca"],[1,"#7db9e8"]];g._gradientPress=f.createLinearGradient(0,0,0,g._height,h)}function a(f){return f["_gradient"+b.States[f._state]]}debug.info("UI module Button submodule is installed.")})(OOPCanvas);(function(b){b.initialize(function(h){h._visualManager=new e(h);h.installHook(function(i){i._visualManager.render()});debug.info("visualManager module is init'ed.")});b.prototype.addChild=function(h){this._visualManager.addChild(h)};b.prototype.addChildren=function(h){this._visualManager.addChildren(h)};b.prototype.removeChildById=function(h){this._visualManager.removeChildById(h)};b.prototype.removeChild=function(h){this._visualManager.removeChild(h)};b.prototype.removeChildren=function(h){this._visualManager.removeChildren(h)};b.prototype.removeAll=function(){this._visualManager.removeChildren()};function e(h){this._oc=h;this._children=new b.Collections.Dict(function(j,i){return j.getZIndex()-i.getZIndex()});this._isDirty=true;this._hitTestResults=[];this._lastHitTestElement=null}e.prototype.addChild=function(i){var h=i.getId();this._children.add(h,i);this._isDirty=true};e.prototype.addChildren=function(k){var h=[];var j,n,m;var l=k.length;for(j=0;j<l;j++){n=k[j];m=[n.getId(),n];h.push(m)}this._children.addItems(h);this._isDirty=true};e.prototype.removeChildById=function(h){if(this._children.contain(h)){this._children.remove(h);this._isDirty=true}};e.prototype.removeChild=function(i){var h=i.getId();this.removeChildById(h)};e.prototype.removeChildren=function(j){this._isDirty=true;if(typeof j==="undefined"){this._children.removeAll();return}var k=[];var h,m;var l=j.length;for(h=0;h<l;h++){m=j[h];k.push(m.getId())}this._children.removeItems(k)};e.prototype.render=function(){a(this);if(c(this)){d(this);f(this);this._isDirty=false}};function a(l){var j=l._oc;var i=j._dequeueEvent();var n;if(!i){return}var m=l._hitTestResults;m.length=0;l._children.iterate(function(p,r){var q=r.hitTest(i.left,i.top);if(!!q){q.event=i;m.unshift(q)}});n=m[0];m.length=0;var h=l._lastHitTestElement;if(!!h&&(!n||h.getId()!=n.element.getId())){g(l._lastHitTestElement,"mouseout")}if(!!n){var o=n.element;var k=n.event.type;if(k==="mousemove"&&(!h||h.getId()!=n.element.getId())){n.event.type="mouseover"}g(o,n.event.type)}l._lastHitTestElement=!!n?n.element:null}function g(i,h){i["_"+h]()}function c(h){var j=h._isDirty;var i=new Date().getTime();h._children.iterate(function(k,l){j|=l.update(i)});return !!j}function d(i){var h=i._oc;h.clearAll()}function f(h){h._children.iterate(function(i,j){j.draw()})}debug.info("visualManager module is installed.")})(OOPCanvas);